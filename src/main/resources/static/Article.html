<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>文章显示页面</title>
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap-theme.min.css">
    <link href="blog.css" rel="stylesheet">
    <script src="bootstrap/js/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap-markdown/js/bootstrap-markdown-editor.js"></script>
    <script src="bootstrap-markdown/js/ace.js"></script>
    <script src="bootstrap-markdown/js/marked.min.js"></script>
</head>
<body>
<div class="blog-masthead">
    <div class="container">
        <nav class="blog-nav">
            <a class="blog-nav-item" href="index.html">Home</a>
            <a class="blog-nav-item pull-right" href="#" id="user"></a>
        </nav>
    </div>
</div>
<div class="container">
    <div class="blog-header">
        <h1 class="blog-title" id="title" style="font-family: 华文行楷"></h1><br>
        <p class="lead blog-description" id="summary"></p>
    </div>
 <div class="blog-post">
     <p>written by <a id="author"></a></p>
     <hr>
     <div id="content">
         
     </div>
 </div>
    <nav>
        <ul class="pager">
            <li><a href="javascript:void(0);" onclick="clickGood()">点赞(<label id="likeNum">0</label>)</a></li>
        </ul>
    </nav>
    <!--评论区-->
    <div>
        <section class="my-5">

            <!-- Grid row -->
            <div class="row">

                <!-- Grid column -->
                <div class="col-md-12">

                    <!-- Newsfeed -->
                    <div class="mdb-feed">

                        <!-- First news -->
                        <div class="news">

                            <!-- Label -->
                            <div class="label">
                                <img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-1-mini.jpg" class="rounded-circle z-depth-1-half">
                            </div>

                            <!-- Excerpt -->
                            <div class="excerpt">

                                <!-- Brief -->
                                <div class="brief">
                                    <a class="name">John Doe</a> added you as a friend
                                    <div class="date">1 hour ago</div>
                                </div>

                                <!-- Feed footer -->
                                <div class="feed-footer">
                                    <a class="like">
                                        <i class="fas fa-heart"></i>
                                        <span>5 likes</span>
                                    </a>
                                </div>

                            </div>
                            <!-- Excerpt -->

                        </div>
                        <!-- First news -->

                        <!-- Second news -->
                        <div class="news">

                            <!-- Label -->
                            <div class="label">
                                <img src="https://mdbootstrap.com/img/Photos/Avatars/img%20(17)-mini.jpg" class="rounded-circle z-depth-1-half">
                            </div>

                            <!-- Excerpt -->
                            <div class="excerpt">

                                <!-- Brief -->
                                <div class="brief">
                                    <a class="name">Anna Smith</a> added
                                    <a> 2 new illustrations</a>
                                    <div class="date">4 hours ago</div>
                                </div>

                                <!-- Added images -->
                                <div class="added-images">
                                    <img src="https://mdbootstrap.com/img/Photos/Others/images/71.jpg" class="z-depth-1 rounded mb-md-0 mb-2">
                                    <img src="https://mdbootstrap.com/img/Photos/Others/images/74.jpg" class="z-depth-1 rounded">
                                </div>

                                <!-- Feed footer -->
                                <div class="feed-footer">
                                    <a class="like">
                                        <i class="fas fa-heart"></i>
                                        <span>18 likes</span>
                                    </a>
                                </div>

                            </div>
                            <!-- Excerpt -->

                        </div>
                        <!-- Second news -->

                        <!-- Third news -->
                        <div class="news">

                            <!-- Label -->
                            <div class="label">
                                <img src="https://mdbootstrap.com/img/Photos/Avatars/img%20(9)-mini.jpg" class="rounded-circle z-depth-1-half">
                            </div>

                            <!-- Excerpt -->
                            <div class="excerpt">

                                <!-- Brief -->
                                <div class="brief">
                                    <a class="name">Danny Moore</a> added you as a friend
                                    <div class="date">7 hours ago</div>
                                </div>

                                <!-- Feed footer -->
                                <div class="feed-footer">
                                    <a class="like">
                                        <i class="fas fa-heart"></i>
                                        <span>11 likes</span>
                                    </a>
                                </div>

                            </div>
                            <!-- Excerpt -->

                        </div>
                        <!-- Third news -->

                        <!-- Fourth news -->
                        <div class="news">

                            <!-- Label -->
                            <div class="label">
                                <img src="https://mdbootstrap.com/img/Photos/Avatars/img%20(18)-mini.jpg" class="rounded-circle z-depth-1-half">
                            </div>

                            <!-- Excerpt -->
                            <div class="excerpt">

                                <!-- Brief -->
                                <div class="brief">
                                    <a class="name">Lili Rose</a> posted on his page
                                    <div class="date">2 days ago</div>
                                </div>

                                <!-- Added text -->
                                <div class="added-text">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Vero inventore,
                                    iste quas libero eius? Vitae sint neque animi alias sunt dolor, accusantium ducimus, non placeat
                                    voluptate.
                                </div>

                                <!-- Feed footer -->


                            </div>
                            <!-- Excerpt -->

                        </div>
                        <!-- Fourth news -->

                        <!-- Fifth news -->
                        <div class="news">

                            <!-- Label -->
                            <div class="label">
                                <img src="https://mdbootstrap.com/img/Photos/Avatars/img%20(20)-mini.jpg" class="rounded-circle z-depth-1-half">
                            </div>

                            <!-- Excerpt -->
                            <div class="excerpt mb-0">

                                <!-- Brief -->
                                <div class="brief">
                                    <a class="name">Kate Harrison</a> added
                                    <a> 2 new photos</a> of you
                                    <div class="date">3 days ago</div>
                                </div>

                                <!-- Added images -->
                                <div class="added-images">
                                    <img src="https://mdbootstrap.com/img/Photos/Others/images/29.jpg" class="z-depth-1 rounded mb-md-0 mb-2">
                                    <img src="https://mdbootstrap.com/img/Photos/Others/images/31.jpg" class="z-depth-1 rounded">
                                </div>

                                <!-- Feed footer -->
                                <div class="feed-footer">
                                    <a class="like">
                                        <i class="fas fa-heart"></i>
                                        <span>53 likes</span>
                                    </a>
                                </div>

                            </div>
                            <!-- Excerpt -->

                        </div>
                        <!-- Fifth news -->

                    </div>
                    <!-- Newsfeed -->

                </div>
                <!-- Grid column -->

            </div>
            <!-- Grid row -->

        </section>
        <!-- Section: Social newsfeed v.1 -->
    </div><!--评论区结束-->
</div>
<footer class="blog-footer">
    <p>Blog  for <a href="http://getbootstrap.com">MD</a> by <a href="https://twitter.com/mdo">@wwb</a>.</p>
    <p>
        welcome !
    </p>
</footer>
<script>
    function getQueryString(name){
        var reg = new RegExp("(^|&)"+name+"=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if(r!=null){
            return decodeURIComponent(r[2]);
        }
        return '';
    }
    var articleId=getQueryString('articleId');
    /**
     * 点赞功能
     */
    function clickGood() {
        console.log("good into");
        $.post("/article/addLike", {
            articleId: articleId
        }, function (data, status) {
            var resp=JSON.parse(data.trim());
            if (status.trim() == 'success' && resp.statu==true) {
                var last=parseInt($("#likeNum").html());
                alert("点赞成功！");
                $("#likeNum").html(last+1);
            }else{
                alert("点赞错误，可能是未登录或是已点过赞造成！");
            }
        });
        //     $.ajax({
        //         url:"/article/addLike",
        //         type:"post",
        //         data:articleId,
        //         async:true,
        //         success:function (data) {
        //             var resp=JSON.parse(data);
        //             if(resp.statu==true){
        //                 var last=$("#likeNum").val();
        //                 $("#likeNum").val(last+1);
        //             }else{
        //                 alert("您可能已经点过赞了！");
        //             }
        //         },
        //         error:function (data) {
        //             alert("点赞错误！");
        //         }
        //     });
        // }
    }
    console.log(articleId);
    $(document).ready(function () {
        //**************获取用户信息
        $.ajax({
            url:"/user/getUser",
            type:"get",
            async:true,
            success:function (data) {
                var resp=JSON.parse(data.trim());
                if(resp.statu==true){
                    $("#user").attr('href','userspace.html?name='+resp.userName);
                    $("#user").html(resp.userName);
                }else{
                    $("#user").attr('href','index.html');
                    $("#user").html("返回主页");
                }
            },
            error:function (data) {
                $("#user").attr('href','index.html');
                $("#user").html("返回主页");
            }
        });
        $.post("/article/getArticle",{
            articleId:articleId
        },function (data,status) {
            var resp=JSON.parse(data.trim());
                   var article=resp.article;
                   if(resp.statu==true){
                       $("#title").html(article.article_title);
                       //$("#author").append("<a href=\'userspace.html?name="+article.user_name+"\'></a>");
                       $("#author").html(article.user_name);
                       $("#author").attr("href","userspace.html?name="+article.user_name);
                       $("#summary").html(article.article_short);
                       console.log(article.user_name);
                       $("#likeNum").html(article.article_like);
                       $("#content").html(marked(article.article_content));
                   }else{
                       alert("文章加载失败，请稍后重试！");
                   }
        });
        // $.ajax({
        //    url:"/article/getArticle",
        //    data:articleId,
        //    type:"post",
        //    async:true,
        //    success:function (data) {
        //        var resp=JSON.parse(data.trim());
        //        var article=resp.article;
        //        if(resp.statu==true){
        //            $("#title").html(article.title);
        //            $("#author").html(article.author);
        //            $("#summary").html(article.summary);
        //            $("#content").html(marked(article.article));
        //        }else{
        //            alert("文章加载失败，请稍后重试！");
        //        }
        //    } ,
        //     error:function (data) {
        //         alert("文章加载失败，请稍后重试！");
        //     }
        // });

        //**************************在此上添加函数***********
    })
</script>
</body>
</html>